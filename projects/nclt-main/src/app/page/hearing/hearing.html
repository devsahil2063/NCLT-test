<div class="min-h-screen bg-page p-2">
  <!-- Header Section -->
  <div class="bg-white rounded-lg shadow-sm p-6 flex items-center justify-between mb-4">
    <!-- Search Bar -->
    <div class="mb-4 flex items-center gap-4">
      <p-iconfield class="bg-white min-w-lg">
        <p-inputicon class="pi pi-search" />
        <input class="w-full bg-white" type="text" pInputText [(ngModel)]="searchTerm" placeholder="Search hearings..."
          pSize="small" />
      </p-iconfield>
    </div>
    <div class="flex items-center gap-3">
      <p-button label="Outcome" [outlined]="true" icon="pi pi-filter" styleClass="bg-white" size="small" />
      <p-button label="Date Range" [outlined]="true" icon="pi pi-calendar" styleClass="bg-white" size="small" />
      <p-button label="Add Hearing" icon="pi pi-plus" severity="danger" (onClick)="showAddDialog()" size="small" />
    </div>
  </div>

  <!-- Table Card -->
  <p-card class="shadow-sm custom-card">
    <p-table [value]="filteredHearings" [tableStyle]="{ 'min-width': '100%' }" showGridlines class="custom-table">
      <ng-template pTemplate="header">
        <tr>
          <th class="text-left" style="width: 4rem">Action</th>
          <th class="text-left">Date of Hearing</th>
          <th class="text-left">Next Date of Hearing</th>
          <th class="text-left">Gist of Hearing</th>
          <th class="text-left">View Court Order</th>
          <th class="text-left">Name of Bank Official's</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-hearing>
        <tr>
          <td>
            <div class="flex items-center gap-2">
              <button (click)="viewHearing(hearing)"
                class="rounded p-1.5 text-gray-600 transition-colors hover:bg-gray-100" title="View">
                <i class="pi pi-eye"></i>
              </button>
              <button (click)="editHearing(hearing)"
                class="rounded p-1.5 text-gray-600 transition-colors hover:bg-gray-100" title="Edit">
                <i class="pi pi-pencil"></i>
              </button>
              <button (click)="deleteHearing(hearing)"
                class="rounded p-1.5 text-red-600 transition-colors hover:bg-red-50" title="Delete">
                <i class="pi pi-trash"></i>
              </button>
            </div>
          </td>
          <td class="text-body">{{ hearing.dateOfHearing }}</td>
          <td class="text-body">{{ hearing.nextDateOfHearing }}</td>
          <td class="text-body">
            <div class="max-w-md truncate">{{ hearing.gistOfHearing }}</div>
          </td>
          <td>
            <button (click)="downloadCourtOrder(hearing)"
              class="flex items-center gap-3 text-[--p-primary-color] transition-colors hover:text-[--p-primary-600]">
              <i class="pi pi-download text-primary!"></i>
              <span class="text-primary">Download</span>
            </button>
          </td>
          <td class="text-body">{{ hearing.bankOfficialName }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center">
            <div class="py-8">
              <i class="pi pi-inbox mb-3 text-4xl text-gray-400"></i>
              <p class="text-muted text-lg">No hearings found</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- Add/Edit Hearing Dialog -->
  <p-dialog [header]="isEditMode ? 'Edit Hearing' : 'Add Hearing'" [resizable]="false" [modal]="true"
    [maximizable]="false" [draggable]="false" appendTo="body" [(visible)]="dialogVisible" [style]="{ width: '40vw' }"
    [contentStyle]="{ overflow: 'auto' }">
    <p class="page-subheading">
      {{ isEditMode ? 'Update hearing details and outcomes' : 'Enter hearing details and outcomes' }}
    </p>
    <p-divider></p-divider>

    <div class="mt-4 flex flex-col gap-6">
      <!-- Hearing Details Section -->
      <div>
        <h3 class="text-(--p-text-sectionheading)">Hearing Details</h3>
        <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
          <!-- Date of Hearing -->
          <div class="flex flex-col gap-2">
            <label for="dateOfHearing" class="field-label">
              Date of Hearing <span class="text-red-500">*</span>
            </label>
            <p-datepicker id="dateOfHearing" [(ngModel)]="dateOfHearing" dateFormat="dd----yyyy --:-- --"
              placeholder="dd----yyyy --:-- --" [showIcon]="true" [showTime]="true" class="w-full" size="small" />
          </div>

          <!-- EC Number of Bank Official's Attended -->
          <div class="flex flex-col gap-2">
            <label for="ecNumber" class=" field-label">
              EC Number of Bank Official's Attended
            </label>
            <input id="ecNumber" type="text" pInputText [(ngModel)]="ecNumber" placeholder="Enter EC number"
              class="w-full" pSize="small" />
          </div>

          <!-- Name -->
          <div class="flex flex-col gap-2">
            <label for="bankOfficialName" class=" field-label">Name</label>
            <input id="bankOfficialName" type="text" pInputText [(ngModel)]="bankOfficialName"
              placeholder="Bank representative name" class="w-full" pSize="small" />
          </div>

          <!-- Designation -->
          <div class="flex flex-col gap-2">
            <label for="bankOfficialDesignation" class="field-label">
              Designation
            </label>
            <input id="bankOfficialDesignation" type="text" pInputText [(ngModel)]="bankOfficialDesignation"
              placeholder="Enter designation" class="w-full" pSize="small" />
          </div>
        </div>
      </div>

      <!-- Hearing Outcome Section -->
      <div>
        <h3 class="text-(--p-text-sectionheading) mb-4">Hearing Outcome</h3>
        <div class="flex flex-col gap-4">
          <!-- Gist of Hearing -->
          <div class="flex flex-col gap-2">
            <label for="gistOfHearing" class=" field-label">
              Gist of Hearing <span class="text-red-500">*</span>
            </label>
            <textarea id="gistOfHearing" pInputTextarea [(ngModel)]="gistOfHearing" placeholder="Enter hearing summary"
              rows="4" class="w-full" pSize="small"></textarea>
          </div>

          <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
            <!-- Hearing Outcome -->
            <div class="flex flex-col gap-2">
              <label for="hearingOutcome" class="field-label">
                Hearing Outcome <span class="text-red-500">*</span>
              </label>
              <p-select id="hearingOutcome" [(ngModel)]="hearingOutcome" [options]="hearingOutcomeOptions"
                optionLabel="label" optionValue="value" placeholder="Select outcome" class="w-full" size="small"
                [checkmark]="true"></p-select>
            </div>

            <!-- Next Date of Hearing -->
            <div class="flex flex-col gap-2">
              <label for="nextDateOfHearing" class=" field-label">
                Next Date of Hearing
              </label>
              <p-datepicker id="nextDateOfHearing" [(ngModel)]="nextDateOfHearing" dateFormat="dd----yyyy"
                placeholder="dd----yyyy" [showIcon]="true" class="w-full" size="small" />
              <small class="text-xs text-gray-500">Required if Adjourned</small>
            </div>
          </div>

          <!-- Reason for Adjournment -->
          <div class="flex flex-col gap-2">
            <label for="adjournmentReason" class="text-sm font-medium field-label">
              Reason for Adjournment (if any)
            </label>
            <textarea id="adjournmentReason" pInputTextarea [(ngModel)]="adjournmentReason"
              placeholder="Enter reason if adjourned" rows="3" class="w-full" pSize="small"></textarea>
          </div>
        </div>
      </div>

      <!-- Order Details Section -->
      <div>
        <h3 class="text-(--p-text-sectionheading) mb-4">Order Details</h3>
        <div class="flex flex-col gap-4">
          <!-- Order Passed -->
          <div class="flex flex-col gap-2">
            <label class="field-label">
              Order Passed <span class="text-red-500">*</span>
            </label>
            <div class="flex items-center gap-6 mt-2">
              <div class="flex items-center gap-2">
                <p-radiobutton name="orderPassed" value="yes" [(ngModel)]="orderPassed"
                  inputId="orderYes"></p-radiobutton>
                <label for="orderYes" class="text-sm cursor-pointer">Yes</label>
              </div>
              <div class="flex items-center gap-2">
                <p-radiobutton name="orderPassed" value="no" [(ngModel)]="orderPassed"
                  inputId="orderNo"></p-radiobutton>
                <label for="orderNo" class="text-sm cursor-pointer">No</label>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
            <!-- Order Date -->
            <div class="flex flex-col gap-2">
              <label for="orderDate" class="field-label">Order Date</label>
              <p-datepicker id="orderDate" size="small" [(ngModel)]="orderDate" dateFormat="dd----yyyy"
                placeholder="dd----yyyy" [showIcon]="true" class="w-full" />
              <small class="text-xs text-gray-500">If Order Passed = Yes</small>
            </div>

            <!-- Order Number -->
            <div class="flex flex-col gap-2">
              <label for="orderNumber" class="field-label">Order Number</label>
              <input id="orderNumber" type="text" pSize="small" pInputText [(ngModel)]="orderNumber"
                placeholder="Enter order number" class="w-full" />
              <small class="text-xs text-gray-500">If Order Passed = Yes</small>
            </div>
          </div>

          <!-- Upload Order Copy (PDF) -->
          <div class="flex flex-col gap-2">
            <label class="field-label">Upload Order Copy (PDF)</label>
            <div
              class="relative flex items-center justify-center py-8 px-4 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 cursor-pointer hover:bg-gray-100 transition-colors"
              (click)="orderCopyInput.click()">
              <input #orderCopyInput type="file" class="hidden" accept=".pdf" (change)="onOrderCopySelect($event)" />
              <div class="flex flex-col items-center gap-2 text-gray-600">
                <i class="pi pi-download text-2xl text-gray-400"></i>
                <span class="text-sm font-medium">Click to upload or drag and drop</span>
                <span class="text-xs text-gray-500">PDF (max. 10MB) - If Order Passed = Yes</span>
              </div>
            </div>
            <div *ngIf="orderCopyFileName" class="mt-2">
              <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                <span class="text-sm text-gray-700">{{ orderCopyFileName }}</span>
                <button (click)="removeOrderCopy()" class="text-red-500 hover:text-red-700">
                  <i class="pi pi-times"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Court Directions Section -->
      <div>
        <h3 class="text-(--p-text-sectionheading) mb-4">Court Directions</h3>
        <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
          <!-- Stayed by Court -->
          <div class="flex flex-col gap-2">
            <label for="stayedByCourt" class="field-label">Stayed by Court</label>
            <p-select id="stayedByCourt" size="small" [(ngModel)]="stayedByCourt" [options]="stayedByCourtOptions"
              optionLabel="label" optionValue="value" placeholder="Select" class="w-full" [checkmark]="true"></p-select>
          </div>

          <!-- Number of Days -->
          <div class="flex flex-col gap-2">
            <label for="numberOfDays" class="field-label">Number of Days</label>
            <input id="numberOfDays" type="text" pSize="small" pInputText [(ngModel)]="numberOfDays"
              placeholder="Enter number of days" class="w-full" />
          </div>
        </div>
      </div>

      <!-- Impact on CIRP Timeline Section -->
      <div>
        <h3 class=" text-(--p-text-sectionheading) mb-4">Impact on CIRP Timeline</h3>
        <div class="flex flex-col gap-4">
          <!-- Does this affect CIRP Timeline? -->
          <div class="flex flex-col gap-2">
            <label class="field-label">
              Does this affect CIRP Timeline? <span class="text-red-500">*</span>
            </label>
            <div class="flex items-center gap-6 mt-2">
              <div class="flex items-center gap-2">
                <p-radiobutton name="affectsCIRPTimeline" value="yes" [(ngModel)]="affectsCIRPTimeline"
                  inputId="affectsYes"></p-radiobutton>
                <label for="affectsYes" class="text-sm cursor-pointer">Yes</label>
              </div>
              <div class="flex items-center gap-2">
                <p-radiobutton name="affectsCIRPTimeline" value="no" [(ngModel)]="affectsCIRPTimeline"
                  inputId="affectsNo"></p-radiobutton>
                <label for="affectsNo" class="text-sm cursor-pointer">No</label>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
            <!-- Extension Granted -->
            <div class="flex flex-col gap-2">
              <label class="field-label">Extension Granted</label>
              <div class="flex items-center gap-6 mt-2">
                <div class="flex items-center gap-2">
                  <p-radiobutton name="extensionGranted" value="yes" [(ngModel)]="extensionGranted"
                    inputId="extensionYes"></p-radiobutton>
                  <label for="extensionYes" class="text-sm cursor-pointer">Yes</label>
                </div>
                <div class="flex items-center gap-2">
                  <p-radiobutton name="extensionGranted" value="no" [(ngModel)]="extensionGranted"
                    inputId="extensionNo"></p-radiobutton>
                  <label for="extensionNo" class="text-sm cursor-pointer">No</label>
                </div>
              </div>
              <small class="text-xs text-gray-500">If affects timeline</small>
            </div>

            <!-- Extension Period (Days) -->
            <div class="flex flex-col gap-2">
              <label for="extensionPeriod" class="field-label">
                Extension Period (Days)
              </label>
              <input id="extensionPeriod" type="text" pSize="small" pInputText [(ngModel)]="extensionPeriod"
                placeholder="Enter days" class="w-full" />
              <small class="text-xs text-gray-500">If extension granted</small>
            </div>
          </div>

          <!-- New CIRP Deadline -->
          <div class="flex flex-col gap-2">
            <label for="newCIRPDeadline" class="field-label">
              New CIRP Deadline
            </label>
            <p-datepicker id="newCIRPDeadline" size="small" [(ngModel)]="newCIRPDeadline" dateFormat="dd----yyyy"
              placeholder="dd----yyyy" [showIcon]="true" class="w-full" />
            <small class="text-xs text-gray-500">If extension granted</small>
          </div>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-3 mt-6">
        <p-button label="Cancel" [outlined]="true" (onClick)="dialogVisible = false" size="small" />
        <p-button [label]="isEditMode ? 'Update' : '+ Add Hearing'" severity="danger" (onClick)="saveHearing()"
          [disabled]="!dateOfHearing || !gistOfHearing || !hearingOutcome || !orderPassed || !affectsCIRPTimeline"
          size="small" />
      </div>
    </ng-template>
  </p-dialog>
</div>